<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cdp.health.mapper.answer.AnswerMapper">
<!--  변수명 맞춰주지 않으면, sql문법 오류 발생!  -->
<!--  1개 댓글 조회 : board와 siteuser table을 조인  -->
<select id="getAnswer" parameterType="int" resultMap="AnswerResultMap"> SELECT a.num as num, a.content as content, u.id as author_id, u.userId as author_userId, u.email as author_email FROM answer a JOIN SITEUSER u ON a.author_id = u.id WHERE a.num = #{num} </select>
<!--  map을 찾기 위한 코딩  -->
<resultMap id="AnswerResultMap" type="com.cdp.health.dto.answer.Answer">
<id property="num" column="num"/>
<result property="content" column="content"/>
<association property="author" javaType="com.cdp.health.user.SiteUser">
<id property="id" column="author_id"/>
<result property="userId" column="author_userId"/>
<result property="email" column="author_email"/>
</association>
</resultMap>
<select id="maxNum" resultType="int"> select nvl(max(num),0) from answer </select>
<!--  댓글 삽입  -->
<insert id="createAnswer" parameterType="com.cdp.health.dto.answer.Answer"> INSERT INTO answer(num, content, board_id, author_id) VALUES (#{num}, #{content}, #{board.num}, #{author.id}) </insert>
<!--  게시글 댓글 목록 조회  -->
<select id="getAnswerList" parameterType="int" resultType="com.cdp.health.dto.answer.Answer"> SELECT a.num, a.content, b.num AS "board.num", u.userId AS "author.userId" FROM ANSWER a LEFT JOIN BOARD b ON a.board_id = b.num LEFT JOIN SITEUSER u ON a.author_id = u.id WHERE a.board_id = #{boardNum} ORDER BY a.num ASC </select>
<!--  댓글 수정  -->
<update id="modify" parameterType="com.cdp.health.dto.answer.Answer"> UPDATE answer SET content = #{content} WHERE num = #{num} </update>
<!--  댓글 삭제  -->
<delete id="delete" parameterType="int"> DELETE FROM answer WHERE num = #{num} </delete>
<!--  게시글 삭제  -->
<delete id="deleteBoardByNum" parameterType="int"> delete from answer where board_id=#{boardNum} </delete>

</mapper>